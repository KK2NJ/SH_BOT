FROM python:3.11-slim

ENV DEBIAN_FRONTEND=noninteractive

WORKDIR /app

# --- install system dependencies for Chromium ---
RUN apt-get update && apt-get install -y \
    libnss3 libatk1.0-0 libatk-bridge2.0-0 libcups2 libxss1 libasound2 \
    libgbm1 libgtk-3-0 libx11-xcb1 libxcomposite1 libxdamage1 libxrandr2 \
    libgdk-pixbuf-xlib-2.0-0 libpangocairo-1.0-0 libpango-1.0-0 \
    wget ca-certificates gnupg \
    && rm -rf /var/lib/apt/lists/*

# --- Python deps ---
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# --- FORCE playwright browsers into a fixed directory ---
ENV PLAYWRIGHT_BROWSERS_PATH=/ms-playwright

# --- Install Chromium *into the above directory* ---
RUN python -m playwright install chromium

# --- Copy app ---
COPY . .

CMD ["python", "main.py"]
